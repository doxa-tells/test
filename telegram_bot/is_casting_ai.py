import base64
from openai import OpenAI
from dotenv import load_dotenv
import os

load_dotenv()  # –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env

openai_client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
openai_client = OpenAI()

# üîç AI-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
async def is_casting_ai(text, image_path=None):
    content = [{
        "type": "text",
        "text": f"""–¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Ç–µ–∫—Å—Ç –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ **–æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º –∫–∞—Å—Ç–∏–Ω–≥–∞**.

1. **–°–Ω–∞—á–∞–ª–∞** –ø—Ä–æ—á–∏—Ç–∞–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
2. –ó–∞—Ç–µ–º, **–µ—Å–ª–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç ‚Äî —É—á—Ç–∏ –µ–≥–æ.** –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ª–∏—Ü–∞, —ç–º–æ—Ü–∏–∏, —Ñ–æ–Ω) **–∏–≥–Ω–æ—Ä–∏—Ä—É–π –ø–æ–ª–Ω–æ—Å—Ç—å—é.**
3. –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ (–∏–ª–∏ –Ω–∞ —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º) –µ—Å—Ç—å **–º–∏–Ω–∏–º—É–º 1 –∏–∑ 5 –ø—É–Ω–∫—Ç–æ–≤**:
‚Äî –ø—Ä–æ–µ–∫—Ç/—Ç–∏–ø —Å—ä—ë–º–∫–∏,
‚Äî —Ç–∏–ø–∞–∂/—Ä–æ–ª—å,
‚Äî –¥–∞—Ç–∞ —Å—ä—ë–º–∫–∏,
- –≤—Ä–µ–º—è —Å—ä–µ–º–æ–∫,
‚Äî –ª–æ–∫–∞—Ü–∏—è,
‚Äî –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ ‚Äî
–¢–û —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π –∫–∞—Å—Ç–∏–Ω–≥.

–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–π –Ω–µ—Ç ‚Äî –æ—Ç–≤–µ—Ç—å: \"–Ω–µ—Ç\".  
–ï—Å–ª–∏ –≤—Å—ë –ø–æ–¥—Ö–æ–¥–∏—Ç ‚Äî –æ—Ç–≤–µ—Ç—å: \"–¥–∞\".  
–¢–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ: \"–¥–∞\" –∏–ª–∏ \"–Ω–µ—Ç\".

–í–æ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
{text}
"""
    }]

    if image_path:
        try:
            with open(image_path, "rb") as img:
                base64_img = base64.b64encode(img.read()).decode("utf-8")
            content.append({
                "type": "image_url",
                "image_url": {
                    "url": f"data:image/jpeg;base64,{base64_img}",
                    "detail": "low"
                }
            })
        except Exception as e:
            print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–æ—Ç–æ: {e}")

    try:
        print("ü§ñ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ GPT-4o...")
        response = openai_client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[{"role": "user", "content": content}],
            max_tokens=5
        )
        reply = response.choices[0].message.content.lower()
        print(f"üß† AI –æ—Ç–≤–µ—Ç: {reply}")
        return "–¥–∞" in reply
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ AI-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {e}")
        return False